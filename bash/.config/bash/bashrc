# Path/Env (macOS only)
if [[ "$OSTYPE" == "darwin"* ]]; then
  eval "$(/opt/homebrew/bin/brew shellenv 2>/dev/null || /usr/local/bin/brew shellenv 2>/dev/null)"
fi

# Exports
export BASH_SILENCE_DEPRECATION_WARNING=1
[ -f "$HOME/.config/exports/exports.sh" ] && source "$HOME/.config/exports/exports.sh"

# Aliases
[ -f "$HOME/.config/aliases.sh" ] && . "$HOME/.config/aliases.sh"

# Disable: Greeting
[ -f "$HOME/.hushlogin" ] || touch "$HOME/.hushlogin"

# Enable: Starship
eval "$(starship init bash)"

# Enable: VI Keybindings
set -o vi
bind "set show-mode-in-prompt on"
bind "set vi-ins-mode-string \1\e[6 q\2"
bind "set vi-cmd-mode-string \1\e[2 q\2"

# Ensure external commands (like Vim) start with a block cursor
# This resets the cursor shape right before any command runs so
# DECSCUSR from the prompt doesn't leak into TUI programs.
if [[ $- == *i* ]]; then
  trap 'printf "\e[2 q" > /dev/tty' DEBUG
fi

# Enable: Zoxide
eval "$(zoxide init bash)"

# Fzf: load central confi then enable
[ -f "$HOME/.config/fzfrc.sh" ] && . "$HOME/.config/fzfrc.sh"
eval "$(fzf --bash)"

# Yazi shell wrapper
function y() {
	local tmp="$(mktemp -t "yazi-cwd.XXXXXX")" cwd
	yazi "$@" --cwd-file="$tmp"
	IFS= read -r -d '' cwd < "$tmp"
	[ -n "$cwd" ] && [ "$cwd" != "$PWD" ] && builtin cd -- "$cwd"
	rm -f -- "$tmp"
}

# Lazygit wrapper function
lg()
{
    export LAZYGIT_NEW_DIR_FILE=~/.lazygit/newdir

    lazygit "$@"

    if [ -f $LAZYGIT_NEW_DIR_FILE ]; then
            cd "$(cat $LAZYGIT_NEW_DIR_FILE)"
            rm -f $LAZYGIT_NEW_DIR_FILE > /dev/null
    fi
}

# Extras
# echo $(basename "$STARSHIP_SHELL") | figlet | lolcat --animate --speed 100
